---
import { getCollection } from "astro:content";
import NoteCard from "./NoteCard.astro";
import NoNotes from "./NoNotes.astro";

interface Props {
  count?: number;
  showHeader?: boolean;
}

const { count = 3, showHeader = true } = Astro.props;

const notes = await getCollection("notes", ({ data }) => {
  return data.draft !== true;
});

// Sort notes by publish date (newest first) and get only the requested count
const latestNotes = notes
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, count);
---

<section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
  {
    showHeader && (
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900">
          Latest notes
        </h2>
        <a
          href="/notes"
          data-astro-prefetch="hover"
          class="text-sm text-gray-600 hover:text-gray-900 transition-colors"
        >
          View all â†’
        </a>
      </div>
    )
  }

  {
    latestNotes.length > 0 ? (
      <div class="grid gap-6 md:gap-8">
        {latestNotes.map((note, index) => (
          <NoteCard note={note} showBorder={index < latestNotes.length - 1} />
        ))}
      </div>
    ) : (
      <NoNotes />
    )
  }
</section>
